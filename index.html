<!DOCTYPE html>
<html>
<head>
    <title>Valen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #fff;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            position: fixed;
        }
        
        #chat-container {
            width: 100%;
            height: 100%;
            background-color: #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        #chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            -webkit-overflow-scrolling: touch; /* Cho iOS mượt hơn */
        }
        
        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            line-height: 1.4;
            word-wrap: break-word;
            font-size: 16px;
        }
        
        .user-message {
            background-color: #0b93f6;
            align-self: flex-end;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background-color: #444;
            align-self: flex-start;
            color: white;
            border-bottom-left-radius: 5px;
        }
        
        #input-form {
            display: flex;
            border-top: 1px solid #555;
            padding: 10px;
            background-color: #333;
            position: sticky;
            bottom: 0;
        }
        
        #user-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 20px;
            outline: none;
            font-size: 16px;
            background-color: #444;
            color: white;
        }
        
        button {
            margin-left: 8px;
            padding: 0 15px;
            border: none;
            border-radius: 20px;
            background-color: #0b93f6;
            color: white;
            cursor: pointer;
            font-size: 16px;
            min-width: 60px;
        }
        
        button:hover {
            background-color: #007bff;
        }
        
        /* Media Queries cho thiết bị di động */
        @media (max-width: 768px) {
            .message {
                max-width: 85%;
                padding: 10px 12px;
                font-size: 15px;
            }
            
            #user-input {
                padding: 10px 12px;
                font-size: 15px;
            }
            
            button {
                padding: 0 12px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            #chat-messages {
                padding: 10px;
            }
            
            .message {
                max-width: 90%;
                padding: 8px 10px;
                margin-bottom: 8px;
                font-size: 14px;
            }
            
            #input-form {
                padding: 8px;
            }
            
            #user-input {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            button {
                padding: 0 10px;
                font-size: 14px;
                min-width: 50px;
            }
        }
        
        /* Tránh zoom khi nhập liệu trên iOS */
        @media screen and (-webkit-min-device-pixel-ratio:0) { 
            #user-input {
                font-size: 16px;
            }
        }
        
        /* Khắc phục lỗi trên iOS khi bàn phím xuất hiện */
        @supports (-webkit-touch-callout: none) {
            #chat-container {
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-messages"></div>
        <form id="input-form">
            <input type="text" id="user-input" placeholder="Nhập tin nhắn..." autocomplete="off">
            <button type="submit">Gửi</button>
        </form>
    </div>
    <script>
        document.getElementById('input-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();
            if (!message) return;
            
            addMessage('user', message);
            userInput.value = '';
            userInput.focus();
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });
                
                const data = await response.json();
                addMessage('bot', data.reply);
            } catch (error) {
                console.error('Lỗi:', error);
                // Để test giao diện khi không có backend
                const botResponses = [
                    "Xin chào! Tôi có thể giúp gì cho bạn?",
                    "Cảm ơn bạn đã liên hệ. Đây là tin nhắn test.",
                    "Rất vui được trò chuyện với bạn!",
                    "Xin lỗi, tôi không hiểu. Bạn có thể nói rõ hơn không?"
                ];
                const randomResponse = botResponses[Math.floor(Math.random() * botResponses.length)];
                addMessage('bot', randomResponse);
            }
        });
        
        function addMessage(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}-message`;
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Khởi tạo với tin nhắn chào mừng
        window.onload = function() {
            setTimeout(function() {
                addMessage('bot', 'Xin chào! Tôi là Valen. Bạn cần giúp gì không?');
            }, 500);
        };

        // Khắc phục vấn đề khi bàn phím di động hiển thị
        const viewport = document.querySelector('meta[name=viewport]');
        window.addEventListener('resize', () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        });
    </script>
</body>
</html>
